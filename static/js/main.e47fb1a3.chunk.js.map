{"version":3,"sources":["reportWebVitals.ts","Compose.tsx","Api.ts","Log.tsx","MainPage.tsx","index.tsx"],"names":["reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","composeHeight","Compose","value","onChange","onSubmit","userList","useState","send","setSend","inputRef","useRef","handleKeyup","useCallback","e","ctrlKey","key","useEffect","a","text","trim","initialComposeValue","current","console","log","removeEventListener","addEventListener","handleChangeComposeValue","event","target","name","StyledMain","type","placeholder","replyToTextId","replyToUserId","map","user","id","_user_id","slice","ref","rows","cols","className","icon","faPaperPlane","title","onClick","preventDefault","styled","div","end_point","Log","userMap","onClose","Number","MIN_SAFE_INTEGER","updateTimeTrigger","setUpdateTimeTrigger","open","replyDestination","setReplyDestination","useContext","ComposeContext","composeValue","setComposeValue","imageMap","ImageMapContext","loadImages","LoadImagesContext","time","useMemo","now","Date","date","_created_at","diff","getTime","timeDiff","Math","floor","localizedTime","toLocaleString","setInterval","prev","getUser","userId","handleChangeImageFile","files","fileUploader","file","convertBase64Promise","Promise","r","fr","FileReader","onload","result","readAsDataURL","base64","params","bind_text_id","fetch","method","headers","Authorization","body","JSON","stringify","res","json","x","all","Array","from","StyledMeta","description","dateTime","faTimesCircle","in_reply_to_text_id","in_reply_to_user_id","StyledText","length","image","src","alt","faReply","textId","htmlFor","faImages","accept","multiple","hidden","StyledReplyDestinationText","y","createContext","lists","query","encodeURI","MainPage","setUserList","imageList","setImageList","loadLogTrigger","setLoadLogTrigger","reduce","acc","cur","loadUser","handleSubmit","replaceAll","String","raw","Provider","list","Logs","texts","setTexts","loadLog","StyledLogs","ReactDOM","render","StrictMode","exact","path","document","getElementById"],"mappings":"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","file":"static/js/main.e47fb1a3.chunk.js","sourcesContent":["import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React, { useCallback, useEffect, useRef, useState } from \"react\";\nimport { User } from \"./Api\";\nimport { ComposeValue, initialComposeValue } from \"./MainPage\";\nimport { faPaperPlane } from \"@fortawesome/free-solid-svg-icons\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport styled from \"styled-components\";\n\nexport const composeHeight = '100px';\n\nexport const Compose = ({\n  value,\n  onChange,\n  onSubmit,\n  userList\n}: {\n  value: ComposeValue,\n  onChange: (value: ComposeValue) => void,\n  onSubmit: (value: ComposeValue) => void;\n  userList: User[]\n}) => {\n  const [send, setSend] = useState(false);\n\n  const inputRef = useRef<HTMLTextAreaElement>(null);\n\n  const handleKeyup = useCallback((e: KeyboardEvent) => {\n    // Ctrl + Enterで送信\n    if (e.ctrlKey && e.key === 'Enter' && !send) {\n      // ここで送信処理はせず、sendフラグの変更をuseEffectで察知させて、送ることで、古いデータを送らないようにする\n      setSend(true);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  useEffect(() => {\n    (async () => {\n      if (send && value.text.trim()) {\n        setSend(false);\n        onSubmit(value);\n        onChange(initialComposeValue);\n      }\n    })();\n  }, [send, value, onChange, onSubmit]);\n  useEffect(() => {\n    if (inputRef.current) {\n      console.log('effect');\n      inputRef.current.removeEventListener(\"keyup\", handleKeyup, false);\n      inputRef.current.addEventListener(\"keyup\", handleKeyup, false);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [inputRef.current]);\n\n  const handleChangeComposeValue = (event: any) => {\n    onChange({\n      ...value,\n      [event.target.name]: event.target.value,\n    });\n  };\n\n  return (\n    <StyledMain>\n      <form>\n        <div>\n          <input\n            type=\"text\"\n            name=\"replyToTextId\"\n            placeholder=\"ツイートへの返信\"\n            value={value.replyToTextId}\n            onChange={handleChangeComposeValue}\n          />\n          <select\n            name=\"replyToUserId\"\n            value={value.replyToUserId}\n            onChange={handleChangeComposeValue}\n          >\n            <option value=\"\">-</option>\n            {userList.map(user => (\n              <option key={user.id} value={user.id}>\n                {user.name || `匿名(${user._user_id.slice(0, 2)})`}\n              </option>\n            ))}\n          </select>\n        </div>\n        <textarea\n          name=\"text\"\n          ref={inputRef}\n          placeholder=\"今なにしてる？\"\n          rows={4}\n          cols={50}\n          value={value.text}\n          onChange={e => onChange({...value, text: e.target.value})}\n        />\n        <FontAwesomeIcon\n          className=\"clickable\"\n          icon={faPaperPlane}\n          title=\"post\"\n          onClick={(e) => {e.preventDefault();setSend(true);}}\n        />\n      </form>\n    </StyledMain>\n  );\n};\n\nconst StyledMain = styled.div`\n  height: ${composeHeight};\n`;","export const end_point = \"https://versatileapi.herokuapp.com/api\";\n\ntype Base = {\n  id: string;\n  _created_at: string;\n  _updated_at: string;\n  _user_id: string;\n}\n\nexport type Text = Base & {\n  text: string;\n  in_reply_to_user_id?: string; //返信対象のUserId\n  in_reply_to_text_id?: string; //返信対象のTextId\n}\n\nexport type Image = Base & {\n  base64: string;\n  bind_text_id: string;\n}\n\nexport type User = Base & {\n  description: string;\n  name: string;\n}","import React, { ChangeEvent, useContext, useEffect, useMemo } from 'react';\nimport { useState } from \"react\";\nimport { User, Text, end_point } from \"./Api\";\nimport { faImages, faReply, faTimesCircle } from \"@fortawesome/free-solid-svg-icons\";\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport './index.css';\nimport styled from \"styled-components\";\nimport { ComposeContext, ImageMapContext, LoadImagesContext } from \"./MainPage\";\n\nexport const Log = ({\n  text,\n  userMap,\n  onClose,\n}: {\n  text: Text;\n  userMap: Record<string, User>,\n  onClose?: () => void\n}) => {\n  const [updateTimeTrigger, setUpdateTimeTrigger] = useState(Number.MIN_SAFE_INTEGER);\n  const [replyDestination, setReplyDestination] = useState<{\n    text?: Text;\n    open: boolean;\n  }>({open: false});\n\n  const { composeValue, setComposeValue } = useContext(ComposeContext);\n  const imageMap = useContext(ImageMapContext);\n  const loadImages = useContext(LoadImagesContext);\n\n  const time = useMemo(() => {\n    const now = new Date();\n    const date = new Date(text._created_at);\n    const diff = (now.getTime() - date.getTime()) / 1_000;\n    let timeDiff = \"\";\n    if (diff < 60) {\n      timeDiff = `${Math.floor(diff)}秒前`;\n    } else if (diff / 60 < 60) {\n      timeDiff = `${Math.floor(diff / 60)}分前`;\n    } else if (diff / 60 / 60 < 24) {\n      timeDiff = `${Math.floor(diff / 60 / 60)}時間前`;\n    } else {\n      timeDiff = `${Math.floor(diff / 60 / 60 / 24)}日前`;\n    }\n    return {\n      timeDiff,\n      time: text._created_at,\n      localizedTime: date.toLocaleString(\"ja-JP\"),\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [text, userMap, updateTimeTrigger]);\n\n  useEffect(() => {\n    setInterval(() => setUpdateTimeTrigger(prev => prev + 1), 5_000);\n  }, []);\n\n  const getUser = (userId: string) => {\n    return userMap[userId]?.name || `匿名(${userId.slice(0, 2)})`;\n  };\n\n  const handleReplyTo = (x: { textId: string, userId: string }) => {\n    setComposeValue({...composeValue, replyToTextId: x.textId,  replyToUserId: x.userId})\n  };\n\n  const handleChangeImageFile = async (e: ChangeEvent<HTMLInputElement>) => {\n    if (!e.target.files) return;\n\n    const fileUploader = async (file: File) => {\n      const convertBase64Promise = new Promise((r) => {\n        const fr = new FileReader();\n        fr.onload = (e) => {\n          r(e.target?.result);\n        };\n        fr.readAsDataURL(file);\n      });\n      const base64 = (await convertBase64Promise) as any as string;\n      const params = {\n        base64,\n        bind_text_id: text.id,\n      }\n      await fetch(`${end_point}/image`, {\n        method: \"POST\",\n        headers: {Authorization: \"evolution\"},\n        body: JSON.stringify(params),\n      }).then((res) => res.json()).then(x => console.log(x));\n    };\n\n    await Promise.all(Array.from(e.target.files).map(fileUploader));\n\n    loadImages();\n  };\n\n  return (\n    <StyledMain>\n      <StyledMeta>\n        <div\n          title={userMap[text._user_id]?.description || text._user_id}>\n          {getUser(text._user_id)}\n        </div>\n        <div>\n          <time dateTime={time.time} title={time.localizedTime}>\n            {time.timeDiff}\n          </time>\n          {onClose ?\n            <FontAwesomeIcon className=\"clickable ml1\" icon={faTimesCircle} onClick={onClose}/>\n            : null\n          }\n        </div>\n      </StyledMeta>\n      <div>\n        <div\n          onClick={async () => {\n            if(!text.in_reply_to_text_id) return;\n            if(replyDestination.text){\n              setReplyDestination(prev => ({\n                ...prev,\n                open: true,\n              }))\n              return;\n            }\n            await fetch(`${end_point}/text/${text.in_reply_to_text_id}`)\n              .then((res) => (res.json()))\n              .then(x => {\n                setReplyDestination({\n                  text: x,\n                  open: true,\n                })\n              });\n          }\n        }\n          >\n          {text.in_reply_to_text_id ? `ReplyTo: ${text.in_reply_to_text_id} `: ''}\n        </div>\n        <div>\n          {text.in_reply_to_user_id ? `@${getUser(text.in_reply_to_user_id)} `: ''}\n        </div>\n        <StyledText>\n          {text.text}\n        </StyledText>\n      </div>\n      {imageMap[text.id]?.length ?\n        imageMap[text.id].map(image => (\n          <div>\n            <img src={image.base64} alt={text.text} />.\n          </div>\n        ))\n        : null\n      }\n      <div className=\"flex mt1\">\n        <FontAwesomeIcon\n          className=\"clickable\"\n          icon={faReply}\n          title=\"reply\"\n          onClick={() => handleReplyTo({textId: text.id, userId: text._user_id})}\n        />\n        <label htmlFor={`image_upload_${text.id}`}>\n          <FontAwesomeIcon\n            className=\"clickable ml2\"\n            icon={faImages}\n            title=\"images\"\n          />\n          <input\n            id={`image_upload_${text.id}`}\n            type=\"file\"\n            accept=\"image/*\"\n            multiple\n            hidden\n            onChange={handleChangeImageFile}\n          />\n        </label>\n      </div>\n      {\n        replyDestination.open && replyDestination.text?\n          (\n            <StyledReplyDestinationText\n              x={onClose ? 0 : 8}\n              y={16}\n            >\n              <Log\n                text={replyDestination.text}\n                userMap={userMap}\n                onClose={() => setReplyDestination(prev => ({...prev, open: false}))}\n              />\n            </StyledReplyDestinationText>\n          )\n          : null\n      }\n    </StyledMain>\n  );\n};\n\nconst StyledMain = styled.div`\n  border: 1px solid #ccc;\n  padding: 8px;\n`;\n\nconst StyledMeta = styled.div`\n  display: flex;\n  justify-content: space-between;\n`;\n\nconst StyledText = styled.div`\n  word-wrap: break-word;\n  white-space: pre-wrap;\n  padding-top: 2px;\n`;\n\nconst StyledReplyDestinationText = styled.div<{x: number, y: number}>`\n  margin-left: ${({x}) => x}px;\n  margin-top: ${({y}) => y}px;\n`;\n","import React, { createContext, useEffect, useMemo } from 'react';\nimport { useState } from \"react\";\nimport { Compose, composeHeight } from \"./Compose\";\nimport { end_point, User, Text, Image } from \"./Api\";\nimport {Log} from \"./Log\";\nimport './index.css';\nimport styled from \"styled-components\";\n\nexport type ComposeValue = { text: string, replyToTextId: string, replyToUserId: string }\n\nexport const initialComposeValue: ComposeValue = {text: \"\", replyToTextId: \"\", replyToUserId: \"\"};\n\nexport const ComposeContext =\n  createContext<{ composeValue: ComposeValue, setComposeValue: (value: ComposeValue) => void }>(\n    {composeValue: initialComposeValue, setComposeValue: (value: ComposeValue) => {}}\n  );\n\nexport const ImageMapContext = createContext<Record<string, Image[]>>({});\n\nexport const LoadImagesContext = createContext<() => void>(() => {});\n\nconst lists = [\n  {\n    name: 'All',\n    query: encodeURI(\"$filter=_user_id ne 'd9ecf9245defb6b07cb86fe92a6fde9e735fc9f9'&$orderby=_created_at desc&$limit=20\"),\n  },\n  {\n    name: 'To me',\n    query: encodeURI(\"$filter=in_reply_to_user_id eq '57039384a74e1fed39b1663b460b7e7f51f99bee'&$orderby=_created_at desc&$limit=20\")\n  },\n  {\n    name: 'Self',\n    query: encodeURI(\"$filter=_user_id eq '57039384a74e1fed39b1663b460b7e7f51f99bee'&$orderby=_created_at desc&$limit=20\")\n  },\n]\n\nexport const MainPage = () => {\n  const [userList, setUserList] = useState<User[]>([]);\n  const [imageList, setImageList] = useState<Image[]>([]);\n  const [composeValue, setComposeValue] = useState<ComposeValue>(initialComposeValue);\n  const [loadLogTrigger, setLoadLogTrigger] = useState(Number.MIN_SAFE_INTEGER);\n\n  const userMap: Record<string, User> = useMemo(() => userList.reduce((acc: any, cur: { id: any; }) => ({\n    ...acc,\n    [cur.id]: cur\n  }), {}), [userList]);\n\n  const imageMap: Record<string, Image[]> = useMemo(() => imageList.reduce((acc: any, cur: Image) => ({\n    ...acc,\n    [cur.bind_text_id]: [...(acc[cur.bind_text_id] || []), cur],\n  }), {}), [imageList]);\n\n  const loadUser = () => {\n    fetch(`${end_point}/user/all`)\n      .then((res) => (res.json()))\n      .then(setUserList);\n  };\n\n  const loadImages = () => {\n    fetch(`${end_point}/image/all`)\n      .then((res) => (res.json()))\n      .then(setImageList);\n  };\n\n  const handleSubmit = async ({text, replyToUserId, replyToTextId}: { text: string, replyToUserId?: string, replyToTextId?: string} ) => {\n    const params = {\n      text,\n      ...(replyToUserId ? {in_reply_to_user_id: replyToUserId}: {}),\n      ...(replyToTextId ? {in_reply_to_text_id: replyToTextId}: {}),\n    };\n    // 以下コードにて、'を\"へ置換してるっぽいので、エスケープさせる（\\\"と認識させて、文字列の終端と認識されちゃうのを防止）\n    // https://github.com/HawkClaws/versatileapi/blob/6f7c8db356455f890662b525106d2e1270fa58e8/versatileapi/src/main/java/com/flex/versatileapi/service/VersatileService.java#L154\n    await fetch(`${end_point}/text`, {\n      method: \"POST\",\n      headers: {Authorization: \"HelloWorld\"},\n      body: JSON.stringify(params).replaceAll(\"'\", String.raw`\\'`)\n    }).then((res) => res.json()).then(x => console.log(x));\n\n    loadImages();\n    setLoadLogTrigger(prev => prev+1);\n  };\n\n  useEffect(() => {\n    loadUser();\n    setInterval(loadUser, 60_000 * 10);//10分\n\n    loadImages();\n    setInterval(loadImages, 10_000);\n  }, []);\n\n  return (\n    <div>\n      <Compose value={composeValue} onChange={setComposeValue} onSubmit={handleSubmit} userList={userList} />\n      <LoadImagesContext.Provider value={loadImages}>\n        <ImageMapContext.Provider value={imageMap}>\n          <ComposeContext.Provider value={{composeValue, setComposeValue}}>\n            <div className=\"flex\">\n              {lists.map(list => (\n                <Logs\n                  key={list.name}\n                  name={list.name}\n                  query={list.query}\n                  userMap={userMap}\n                  loadLogTrigger={loadLogTrigger}\n                />\n              ))}\n            </div>\n          </ComposeContext.Provider>\n        </ImageMapContext.Provider>\n      </LoadImagesContext.Provider>\n    </div>\n  );\n};\n\nconst Logs = ({\n  name,\n  query,\n  userMap,\n  loadLogTrigger,\n} : {\n  name: string,\n  query: string,\n  userMap: Record<string, User>,\n  loadLogTrigger?: number,\n}) => {\n  const [texts, setTexts] = useState<Text[]>([]);\n\n  const loadLog = () => {\n    fetch(`${end_point}/text/all?${query}`)\n      .then((res) => (res.json()))\n      .then(setTexts);\n  };\n\n  useEffect(() => {\n    loadLog();\n    setInterval(loadLog, 10_000);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  useEffect(() => loadLog(),\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [loadLogTrigger]);\n\n  return (\n    <StyledLogs>\n      <h3 className=\"m0\">\n        {name}\n      </h3>\n      {texts.map(text => (\n        <Log\n          key={text.id}\n          text={text}\n          userMap={userMap}\n        />\n      ))}\n    </StyledLogs>\n  );\n}\n\nconst StyledLogs = styled.div`\n  width: 320px;\n  height: calc(100vh - ${composeHeight});\n  overflow-y: auto;\n`;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport { BrowserRouter, Switch, Route } from \"react-router-dom\";\nimport reportWebVitals from './reportWebVitals';\nimport { MainPage } from \"./MainPage\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <BrowserRouter>\n      <Switch>\n        <Route exact path=\"/\">\n          <MainPage />\n        </Route>\n      </Switch>\n    </BrowserRouter>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}