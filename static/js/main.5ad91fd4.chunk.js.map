{"version":3,"sources":["reportWebVitals.ts","Compose.tsx","Api.ts","Log.tsx","MainPage.tsx","index.tsx"],"names":["reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","Compose","value","onChange","onSubmit","userList","useState","send","setSend","inputRef","useRef","handleKeydown","e","ctrlKey","keyCode","useEffect","a","text","trim","initialComposeValue","current","addEventListener","handleChangeComposeValue","event","target","name","type","placeholder","replyToTextId","replyToUserId","map","user","id","_user_id","slice","ref","rows","onClick","preventDefault","end_point","Log","userMap","onReplyTo","Number","MIN_SAFE_INTEGER","updateTimeTrigger","setUpdateTimeTrigger","time","useMemo","now","Date","date","_created_at","diff","getTime","timeDiff","Math","floor","localizedTime","toLocaleString","setInterval","prev","getUser","userId","dateTime","title","description","in_reply_to_text_id","in_reply_to_user_id","StyledControlContainer","textId","styled","div","MainPage","texts","setTexts","setUserList","composeValue","setComposeValue","reduce","acc","cur","reloadLog","fetch","res","json","handleSubmit","params","method","headers","Authorization","body","JSON","stringify","x","console","log","ReactDOM","render","StrictMode","exact","path","document","getElementById"],"mappings":"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","file":"static/js/main.5ad91fd4.chunk.js","sourcesContent":["import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React, { useEffect, useRef, useState } from \"react\";\nimport { User } from \"./Api\";\nimport { ComposeValue, initialComposeValue } from \"./MainPage\";\n\nexport const Compose = ({\n  value,\n  onChange,\n  onSubmit,\n  userList\n}: {\n  value: ComposeValue,\n  onChange: (value: ComposeValue) => void,\n  onSubmit: (value: ComposeValue) => void;\n  userList: User[]\n}) => {\n  const [send, setSend] = useState(false);\n\n  const inputRef = useRef<HTMLTextAreaElement>(null);\n\n  const handleKeydown = (e: KeyboardEvent) => {\n    // Ctrl + Enterで送信\n    if (e.ctrlKey && e.keyCode === 13 && !send) {\n      // ここで送信処理はせず、sendフラグの変更をuseEffectで察知させて、送ることで、古いデータを送らないようにする\n      setSend(true);\n    }\n  };\n\n  useEffect(() => {\n    (async () => {\n      if (send && value.text.trim()) {\n        setSend(false);\n        onSubmit(value);\n        onChange(initialComposeValue);\n      }\n    })();\n  }, [send, value, onChange, onSubmit]);\n  useEffect(() => {\n    if (inputRef.current) {\n      inputRef.current.addEventListener(\"keydown\", handleKeydown, false);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [inputRef.current]);\n\n  const handleChangeComposeValue = (event: any) => {\n    onChange({\n      ...value,\n      [event.target.name]: event.target.value,\n    });\n  };\n\n  return (\n    <form>\n      <input\n        type=\"text\"\n        name=\"replyToTextId\"\n        placeholder=\"ツイートへの返信\"\n        value={value.replyToTextId}\n        onChange={handleChangeComposeValue}\n      />\n      <select\n        name=\"replyToUserId\"\n        value={value.replyToUserId}\n        onChange={handleChangeComposeValue}\n      >\n        <option value=\"\">-</option>\n        {userList.map(user => (\n          <option key={user.id} value={user.id}>\n            {user.name || `匿名(${user._user_id.slice(0, 2)})`}\n          </option>\n        ))}\n      </select>\n      <textarea\n        name=\"text\"\n        ref={inputRef}\n        placeholder=\"今なにしてる？\"\n        rows={4}\n        value={value.text}\n        onChange={e => onChange({...value, text: e.target.value})}\n      />\n      <input type=\"submit\" onClick={(e) => {e.preventDefault();setSend(true);}} value=\"send\" />\n    </form>\n  );\n};\n","export const end_point = \"https://versatileapi.herokuapp.com/api\";\n\ntype Base = {\n  id: string;\n  _created_at: string;\n  _updated_at: string;\n  _user_id: string;\n}\n\nexport type Text = Base & {\n  text: string;\n  in_reply_to_user_id?: string; //返信対象のUserId\n  in_reply_to_text_id?: string; //返信対象のTextId\n}\n\nexport type User = Base & {\n  description: string;\n  name: string;\n}","import React, { useEffect, useMemo } from 'react';\nimport { useState } from \"react\";\nimport { User, Text } from \"./Api\";\nimport styled from \"styled-components\";\n\nexport const Log = ({\n  text,\n  userMap,\n  onReplyTo\n}: {\n  text: Text;\n  userMap: Record<string, User>,\n  onReplyTo: (value:{textId: string; userId: string}) => void\n}) => {\n  const [updateTimeTrigger, setUpdateTimeTrigger] = useState(Number.MIN_SAFE_INTEGER);\n\n  const time = useMemo(() => {\n    const now = new Date();\n    const date = new Date(text._created_at);\n    const diff = (now.getTime() - date.getTime()) / 1_000;\n    let timeDiff = \"\";\n    if (diff < 60) {\n      timeDiff = `${Math.floor(diff)}秒前`;\n    } else if (diff / 60 < 60) {\n      timeDiff = `${Math.floor(diff / 60)}分前`;\n    } else if (diff / 60 / 60 < 24) {\n      timeDiff = `${Math.floor(diff / 60 / 60)}時間前`;\n    } else {\n      timeDiff = `${Math.floor(diff / 60 / 60 / 24)}日前`;\n    }\n    return {\n      timeDiff,\n      time: text._created_at,\n      localizedTime: date.toLocaleString(\"ja-JP\"),\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [text, userMap, updateTimeTrigger]);\n\n  useEffect(() => {\n    setInterval(() => setUpdateTimeTrigger(prev => prev + 1), 5_000);\n  }, []);\n\n  const getUser = (userId: string) => {\n    return userMap[userId]?.name || `匿名(${userId.slice(0, 2)})`;\n  }\n\n  return (\n    <div>\n      <div>\n        <time dateTime={time.time} title={time.localizedTime}>\n          {time.timeDiff}\n        </time>\n      </div>\n      <div\n        title={userMap[text._user_id]?.description || text._user_id}>\n        {getUser(text._user_id)}\n      </div>\n      <div>\n        <div>\n          {text.in_reply_to_text_id ? `ReplyTo: ${text.in_reply_to_text_id} `: ''}\n        </div>\n        <div>\n          {text.in_reply_to_user_id ? `@${getUser(text.in_reply_to_user_id)} `: ''}\n        </div>\n        <pre>\n          {text.text}\n        </pre>\n      </div>\n      <StyledControlContainer>\n        <button onClick={() => onReplyTo({textId: text.id, userId: text._user_id})}>↩</button>\n      </StyledControlContainer>\n    </div>\n  );\n};\n\nconst StyledControlContainer = styled.div`\n  display: flex;\n`;\n\n","import React, { useEffect, useMemo } from 'react';\nimport { useState } from \"react\";\nimport { Compose } from \"./Compose\";\nimport { end_point, User, Text } from \"./Api\";\nimport {Log} from \"./Log\";\n\nexport type ComposeValue = { text: string, replyToTextId: string, replyToUserId: string }\n\nexport const initialComposeValue: ComposeValue = {text: \"\", replyToTextId: \"\", replyToUserId: \"\"};\n\nexport const MainPage = () => {\n  const [texts, setTexts] = useState<Text[]>([]);\n  const [userList, setUserList] = useState<User[]>([]);\n  const [composeValue, setComposeValue] = useState<ComposeValue>(initialComposeValue);\n\n  const userMap: Record<string, User> = useMemo(() => userList.reduce((acc: any, cur: { id: any; }) => ({\n    ...acc,\n    [cur.id]: cur\n  }), {}), [userList]);\n\n  const reloadLog = () => {\n    fetch(`${end_point}/text/all?$orderby=_created_at%20desc&$limit=60`)\n      .then((res) => (res.json()))\n      .then(setTexts);\n  };\n\n  const handleSubmit = async ({text, replyToUserId, replyToTextId}: { text: string, replyToUserId?: string, replyToTextId?: string} ) => {\n    const params = {\n      text,\n      ...(replyToUserId ? {in_reply_to_user_id: replyToUserId}: {}),\n      ...(replyToTextId ? {in_reply_to_text_id: replyToTextId}: {}),\n    };\n    await fetch(`${end_point}/text`, {\n      method: \"POST\",\n      headers: {Authorization: \"HelloWorld\"},\n      body: JSON.stringify(params)\n    }).then((res) => res.json()).then(x => console.log(x));\n    reloadLog();\n  };\n\n  useEffect(() => {\n    reloadLog();\n    setInterval(reloadLog, 30_000);\n\n    (async () => {\n      // @ts-ignore\n      await fetch(`${end_point}/user/all`)\n        .then((res) => (res.json()))\n        .then(setUserList);\n    })()\n  }, []);\n\n  return (\n    <div>\n      <Compose value={composeValue} onChange={setComposeValue} onSubmit={handleSubmit} userList={userList} />\n      {texts.map(text => (\n        <Log\n          key={text.id}\n          text={text}\n          userMap={userMap}\n          onReplyTo={(x) =>\n            setComposeValue({...composeValue, replyToTextId: x.textId,  replyToUserId: x.userId})\n          }\n        />\n      ))}\n    </div>\n  );\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport { BrowserRouter, Switch, Route } from \"react-router-dom\";\nimport reportWebVitals from './reportWebVitals';\nimport { MainPage } from \"./MainPage\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <BrowserRouter>\n      <Switch>\n        <Route exact path=\"/\">\n          <MainPage />\n        </Route>\n      </Switch>\n    </BrowserRouter>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}